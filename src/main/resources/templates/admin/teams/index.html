<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/admin-layout}"
>
  <head>
    <title layout:title-pattern="Team Management - %s">Team Management</title>
  </head>
  <body>
    <section layout:fragment="content">
      <div class="content-header">
        <h1>Team Management</h1>
        <div class="header-actions">
          <a th:href="@{/admin/teams/import}" class="btn btn-secondary">
            <i class="fas fa-file-import"></i> Import CSV
          </a>
          <a th:href="@{/admin/teams/export}" class="btn btn-secondary">
            <i class="fas fa-file-export"></i> Export CSV
          </a>
          <a th:href="@{/admin/teams/create}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add New Team
          </a>
        </div>
      </div>

      <!-- Success/Error Messages -->
      <div th:if="${successMessage}" class="alert alert-success" role="alert">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
      </div>

      <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
      </div>

      <!-- Search and Filter Section -->
      <div class="filter-section">
        <form th:action="@{/admin/teams}" method="get" class="filter-form">
          <div class="filter-row">
            <div class="filter-item">
              <input
                type="text"
                name="keyword"
                th:value="${keyword}"
                placeholder="Search by team name..."
                class="form-control"
              />
            </div>

            <div class="filter-item">
              <select name="size" class="form-control" onchange="this.form.submit()">
                <option th:value="10" th:selected="${pageSize == 10}">
                  10 per page
                </option>
                <option th:value="25" th:selected="${pageSize == 25}">
                  25 per page
                </option>
                <option th:value="50" th:selected="${pageSize == 50}">
                  50 per page
                </option>
                <option th:value="100" th:selected="${pageSize == 100}">
                  100 per page
                </option>
              </select>
            </div>

            <div class="filter-actions">
              <button type="submit" class="btn btn-secondary">
                <i class="fas fa-search"></i> Search
              </button>
              <a th:href="@{/admin/teams}" class="btn btn-outline">
                <i class="fas fa-redo"></i> Reset
              </a>
            </div>
          </div>

          <!-- Hidden fields to preserve sort -->
          <input type="hidden" name="sortBy" th:value="${sortBy}" />
          <input type="hidden" name="sortDir" th:value="${sortDir}" />
        </form>
      </div>

      <!-- Results Info -->
      <div class="results-info">
        <p>
          Showing <strong th:text="${teams.size()}">0</strong> of
          <strong th:text="${totalItems}">0</strong> teams
        </p>
      </div>

      <!-- Team Table -->
      <div class="table-container">
        <table class="user-table">
          <thead>
            <tr>
              <th>
                <a
                  th:href="@{/admin/teams(page=${currentPage}, size=${pageSize}, sortBy='id', sortDir=${sortBy == 'id' ? reverseSortDir : 'asc'}, keyword=${keyword})}"
                >
                  #
                  <i
                    class="fas"
                    th:classappend="${sortBy == 'id' ? (sortDir == 'asc' ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'}"
                  ></i>
                </a>
              </th>
              <th>
                <a
                  th:href="@{/admin/teams(page=${currentPage}, size=${pageSize}, sortBy='name', sortDir=${sortBy == 'name' ? reverseSortDir : 'asc'}, keyword=${keyword})}"
                >
                  Team Name
                  <i
                    class="fas"
                    th:classappend="${sortBy == 'name' ? (sortDir == 'asc' ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'}"
                  ></i>
                </a>
              </th>
              <th>Description</th>
              <th>Current Leader</th>
              <th>Members</th>
              <th>
                <a
                  th:href="@{/admin/teams(page=${currentPage}, size=${pageSize}, sortBy='createdAt', sortDir=${sortBy == 'createdAt' ? reverseSortDir : 'desc'}, keyword=${keyword})}"
                >
                  Created At
                  <i
                    class="fas"
                    th:classappend="${sortBy == 'createdAt' ? (sortDir == 'asc' ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'}"
                  ></i>
                </a>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:if="${teams.isEmpty()}">
              <td colspan="7" class="text-center">No teams found</td>
            </tr>
            <tr th:each="team : ${teams}">
              <td th:text="${team.id}">1</td>
              <td>
                <a
                  th:href="@{/admin/teams/{id}(id=${team.id})}"
                  style="
                    color: #007bff;
                    text-decoration: none;
                    font-weight: 500;
                  "
                  th:text="${team.name}"
                  >Team Name</a
                >
              </td>
              <td>
                <span
                  th:if="${team.description != null && !team.description.isEmpty()}"
                  th:text="${#strings.abbreviate(team.description, 50)}"
                  >Description...</span
                >
                <span
                  th:if="${team.description == null || team.description.isEmpty()}"
                  class="text-muted"
                  >No description</span
                >
              </td>
              <td>
                <span th:if="${team.currentLeader != null}">
                  <i class="fas fa-user-tie"></i>
                  <span th:text="${team.currentLeader.name}">Leader Name</span>
                </span>
                <span th:if="${team.currentLeader == null}" class="text-muted">
                  <i class="fas fa-user-slash"></i> No leader
                </span>
              </td>
              <td>
                <span class="badge badge-info">
                  <i class="fas fa-users"></i>
                  <span
                    th:text="${team.memberCount != null ? team.memberCount : 0}"
                    >0</span
                  >
                  members
                </span>
              </td>
              <td
                th:text="${team.createdAt != null ? #temporals.format(team.createdAt, 'dd/MM/yyyy HH:mm') : 'N/A'}"
              >
                01/01/2025 00:00
              </td>
              <td class="action-buttons">
                <a
                  th:href="@{/admin/teams/{id}(id=${team.id})}"
                  class="btn-icon btn-view"
                  title="View"
                >
                  <i class="fas fa-eye"></i>
                </a>
                <a
                  th:href="@{/admin/teams/{id}/edit(id=${team.id})}"
                  class="btn-icon btn-edit"
                  title="Edit"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <form
                  th:action="@{/admin/teams/{id}/delete(id=${team.id})}"
                  method="post"
                  style="display: inline"
                  onsubmit="return confirm('Are you sure you want to delete team &quot;' + this.dataset.teamName + '&quot;? This team must have no active members or projects.');"
                  th:data-team-name="${team.name}"
                >
                  <button
                    type="submit"
                    class="btn-icon btn-delete"
                    title="Delete"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" th:if="${totalPages > 1}">
        <div class="pagination">
          <!-- First Page -->
          <a
            th:href="@{/admin/teams(page=0, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
            class="page-link"
            th:classappend="${currentPage == 0 ? 'disabled' : ''}"
            th:aria-disabled="${currentPage == 0}"
          >
            <i class="fas fa-angle-double-left"></i>
          </a>

          <!-- Previous Page -->
          <a
            th:href="@{/admin/teams(page=${currentPage - 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
            class="page-link"
            th:classappend="${currentPage == 0 ? 'disabled' : ''}"
            th:aria-disabled="${currentPage == 0}"
          >
            <i class="fas fa-angle-left"></i>
          </a>

          <!-- Page Numbers -->
          <th:block th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
            <a
              th:if="${pageNum < 2 || pageNum >= totalPages - 2 || (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)}"
              th:href="@{/admin/teams(page=${pageNum}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
              class="page-link"
              th:classappend="${pageNum == currentPage ? 'active' : ''}"
              th:text="${pageNum + 1}"
              >1</a
            >

            <span
              th:if="${pageNum == 2 && currentPage > 3}"
              class="page-ellipsis"
              >...</span
            >
            <span
              th:if="${pageNum == totalPages - 3 && currentPage < totalPages - 4}"
              class="page-ellipsis"
              >...</span
            >
          </th:block>

          <!-- Next Page -->
          <a
            th:href="@{/admin/teams(page=${currentPage + 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
            class="page-link"
            th:classappend="${currentPage >= totalPages - 1 ? 'disabled' : ''}"
            th:aria-disabled="${currentPage >= totalPages - 1}"
          >
            <i class="fas fa-angle-right"></i>
          </a>

          <!-- Last Page -->
          <a
            th:href="@{/admin/teams(page=${totalPages - 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
            class="page-link"
            th:classappend="${currentPage >= totalPages - 1 ? 'disabled' : ''}"
            th:aria-disabled="${currentPage >= totalPages - 1}"
          >
            <i class="fas fa-angle-double-right"></i>
          </a>
        </div>

        <div class="pagination-info">
          Page <strong th:text="${currentPage + 1}">1</strong> of
          <strong th:text="${totalPages}">10</strong>
        </div>
      </div>
    </section>
  </body>
</html>
